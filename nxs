#! /bin/sh

# Luis Lavaire 2017, @Nitrux S.A.

# nxs is a simple software installer designed to manage
# AppImage packages. When install is requested, it looks
# for the requested package in local database, and, if
# found, then it installs it (downloads) in 
# $HOME/.local/apps.
#
# When deletion is requested, it looks if the app exists
# in the apps directory and if so, it just deletes it.
#
# It can update all the packages installed to the latest
# version available also. List the ones installed or
# available for installation is supported too.
#
# Very easy, very funny. =D

# - - - 		CONFIG FILES

# ${HOME}/.apps

_DB=".apps/.nxdb"
_APPS_DIR=".apps"


# - - - 		FORMAT OUTPUT

_fail() { echo -e "\n - - \033[38;5;1m $@ \n"; }

_echo() { echo -e "\n - - \033[38;5;5m $@ \n"; }


# - - - 		MAIN FUNCTIONS

_help() { _echo "USAGE: nxs - [s] [r] [u] [l] PKG"; }

_add() {
	for pkg in "$@"; do
#		target=$(grep "$pkg" "$_DB" >/dev/null 2>&1)
#		[[ -z "$target" ]] && { _echo "The name '$pkg' is not valid. Exiting"; exit; }
		echo '$@:' "$@"
	done

	for pkg in "$@"; do
		echo 2
		target=`grep "$pkg" "$_DB" | awk '{ print $3 }'`
		app="${target##*}"
		echo $app
#		wget $target -O "${_APPS_DIR}/${app}.ai"
	done
}

_del() {
	echo 1	
}

_sy() {
	echo 2
}

_ls() {
	[[ -z "$@" ]] && { awk '{ print $1 }' "$_DB" | sort | uniq; } || {
		echo 3
	}
}


# - - - 		PARSE COMMAND LINE

[ ! "$1" ] && _help

case "$1" in
	"-i") shift; _add $@;;
	"-r") shift; _del $@;;
	"-u") shift; _sy $@;;
	"-l") shift; _ls $@;;
	*) _help;;
esac
